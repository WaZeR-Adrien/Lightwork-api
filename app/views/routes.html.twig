{% extends 'layouts/main.html.twig' %}

{% block body %}

    <div id="reference" class="row page grey lighten-3 grey-text text-darken-4">

        {% for key, routes in refs|ksort %}
            <div id="{{ key }}" class="col s12">
                <h4 class="col s6 bold-text">
                    {{ key|capitalize }}
                </h4>
                <hr class="col s6 grey darken-4">
            </div>

            {% for route in routes %}
                <div class="col s12">
                    <div class="col s6 about">
                        <div class="col s12 white-text semibold-text method-and-endpoint {{ route.getMethod()|lower }}">
                            <span class="z-depth-2 method {{ route.getMethod()|lower }}">{{ route.getMethod() }}</span> /{{ route.getEndpoint() }}

                            {% if route.getNeedToken() %}
                                <i class="material-icons right tooltipped" data-position="right" data-tooltip="Secure route by Token">lock</i>
                            {% endif %}
                        </div>

                        {% if route.errors|length > 0 %}
                            <div class="col s12 errors">
                                <h6>Errors of route :</h6>

                                <table class="highlight">

                                    <thead>
                                    <tr>
                                        <th class="col s2">Code</th>
                                        <th class="col s2">Status</th>
                                        <th class="col s8">Message</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    {% for error in route.errors %}
                                        <tr>
                                            <td class="col s2">{{ error.code }}</td>
                                            <td class="col s2">{{ error.status }}</td>
                                            <td class="col s8">{{ error.message }}</td>
                                        </tr>
                                    {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        {% endif %}
                    </div>

                    <div class="col s6 examples grey-text text-lighten-3 grey darken-4">
                        <h5 class="col s12">
                            {{ route.getName() }}
                        </h5>

                        <div class="col s12 request">
                            <h6>Request :</h6>

                            <p class="purple-text text-lighten-1"><i>Header</i></p>
                            <table class="highlight">

                                <thead>
                                <tr>
                                    <th>Key</th>
                                    <th>Value</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr>
                                    <td>Content-Type</td>
                                    <td>application/x-www-form-urlencoded</td>
                                </tr>
                                {% if route.getNeedToken() %}
                                <tr>
                                    <td>X-Auth-Token</td>
                                    <td>YOUR_TOKEN_HERE</td>
                                </tr>
                                {% endif %}
                                </tbody>
                            </table>

                            <p class="purple-text text-lighten-1"><i>{{ route.getTypeParams|length > 0 ? 'Params' : 'No params' }}</i></p>
                            {% if route.getTypeParams|length > 0 %}
                                <table class="highlight">

                                    <thead>
                                    <tr>
                                        <th>Key</th>
                                        <th>Type</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    {% for keyParam, param in route.getTypeParams() %}
                                        {# key is the key of the reference #}
                                        {% if key|last == 's' %}
                                            {% set keyRef = key|capitalize|slice(0, key|length - 1) %}
                                        {% else %}
                                            {% set keyRef = key|capitalize %}
                                        {% endif %}
                                        <tr>
                                            <td>{{ keyParam }}</td>
                                            <td>{{ param }}</td>
                                        </tr>
                                    {% endfor %}
                                    </tbody>
                                </table>
                            {% endif %}

                            <p class="purple-text text-lighten-1"><i>{{ route.getBodies|length > 0 ? 'Bodies' : 'No bodies' }}</i></p>
                            {% if route.getBodies|length > 0 %}
                                <table class="highlight">

                                    <thead>
                                    <tr>
                                        <th>Key</th>
                                        <th>Type</th>
                                        <th>Require</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    {% for keyBody, type in route.getBodies %}
                                        {% if keyBody[:1] == '*' %}
                                            {% set keyBody = keyBody|slice(1, keyBody|length) %}
                                            {% set require = true %}
                                        {% else %}
                                            {% set keyBody = keyBody %}
                                            {% set require = false %}
                                        {% endif %}
                                        <tr>
                                            <td>{{ keyBody }}</td>
                                            <td>{{ type == '' ? 'All' : type|capitalize }}</td>
                                            <td>{{ require ? 'Require' : 'Optional' }}</td>
                                        </tr>
                                    {% endfor %}
                                    </tbody>
                                </table>
                            {% endif %}
                        </div>

                        <div class="col s12 response">
                            <h6>Response :</h6>

                            <p class="purple-text text-lighten-1"><i>Header</i></p>
                            <table class="highlight">

                                <thead>
                                <tr>
                                    <th>Key</th>
                                    <th>Value</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr>
                                    <td>Content-Type</td>
                                    <td>application/json | text/xml</td>
                                </tr>
                                </tbody>
                            </table>

                            <p class="purple-text text-lighten-1"><i>Bodies</i></p>
                            <div class="center-align" style="margin-top:20px;">
                                <a href="https://www.getpostman.com/run-collection/{{ g_postman_collection_id }}" target="_blank"><img src="https://run.pstmn.io/button.svg" alt="Run in Postman"></a>
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        {% endfor %}

    </div>

    <script>
        $(document).ready(function () {
            // Init side nav
            $('.sidenav').sidenav({
                draggable: true
            });

            // Init  collapsible
            $('.collapsible').collapsible();

            // Init tooltip
            $('.tooltipped').tooltip()
        })
    </script>
{% endblock %}
